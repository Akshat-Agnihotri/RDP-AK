name: AvicaRDP

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # Auto restart every 6 hours

jobs:
  build:
    name: Start Building...
    runs-on: windows-latest
    timeout-minutes: 350

    steps:
      - name: Download all required files
        shell: powershell
        run: |
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/setup.py" -OutFile "setup.py"
          Invoke-WebRequest -Uri "https://download.avica.com/AvicaLite_v8.0.8.9.exe" -OutFile "Avica_setup.exe"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/show.bat" -OutFile "show.bat"
          Invoke-WebRequest -Uri "https://gitlab.com/userup908/my-rdp/-/raw/main/loop.bat" -OutFile "loop.bat"

      - name: Setup System User
        shell: powershell
        run: |
          net user runneradmin TheDisa1a

      - name: Install Python Dependencies
        shell: powershell
        run: |
          python.exe -m pip install requests pyautogui telegraph --quiet

      - name: Start Avica Installer
        shell: powershell
        run: |
          Start-Process "Avica_setup.exe"

      - name: Run setup.py (This generates the GoFile link)
        shell: powershell
        run: |
          python setup.py

      - name: Start Avica Service
        shell: cmd
        run: show.bat

      - name: Keep Session Active
        shell: cmd
        run: loop.bat
